<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CardGuard - Credit Card Reminder</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Never miss a credit card payment with CardGuard">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CardGuard">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Orbitron:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* ========================================
           CSS VARIABLES & THEMING
        ======================================== */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-color: #334155;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            --card-shadow-hover: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --glass-bg: rgba(30, 41, 59, 0.8);
            --glass-border: rgba(51, 65, 85, 0.5);
        }

        /* ========================================
           BASE STYLES & RESET
        ======================================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        /* ========================================
           ANIMATED BACKGROUND
        ======================================== */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.04) 0%, transparent 40%);
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(2deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* ========================================
           HEADER & NAVIGATION
        ======================================== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 0.875rem 1.25rem;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .icon-btn {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        .icon-btn:active {
            transform: translateY(0);
        }

        .icon-btn.add-btn {
            background: var(--accent-gradient);
            border: none;
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            font-size: 1.75rem;
            font-weight: 300;
            line-height: 1;
        }

        .icon-btn.add-btn:hover {
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }

        /* ========================================
           NAVIGATION TABS
        ======================================== */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 1px solid var(--border-color);
        }

        .nav-tab.active {
            background: var(--accent-gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: var(--bg-tertiary);
        }

        /* ========================================
           MAIN CONTENT AREA
        ======================================== */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.25rem;
            padding-bottom: 100px;
        }

        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========================================
           STATS CARDS
        ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--card-shadow);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .stat-icon.primary { background: rgba(99, 102, 241, 0.1); }
        .stat-icon.success { background: rgba(16, 185, 129, 0.1); }
        .stat-icon.warning { background: rgba(245, 158, 11, 0.1); }
        .stat-icon.danger { background: rgba(239, 68, 68, 0.1); }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* ========================================
           SECTION HEADERS
        ======================================== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ========================================
           CREDIT CARDS GRID
        ======================================== */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 1.5rem;
        }

        /* ========================================
           CREDIT CARD COMPONENT - PREMIUM REALISTIC DESIGN
        ======================================== */
        /* ========================================
           CREDIT CARD COMPONENT - PREMIUM REALISTIC DESIGN
        ======================================== */
        .credit-card {
            position: relative;
            aspect-ratio: 1.586 / 1;
            border-radius: 20px;
            color: white;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow:
                    0 10px 40px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .credit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            z-index: -1;
        }

        /* Holographic shine effect */
        .credit-card::after {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(
                    45deg,
                    transparent 30%,
                    rgba(255, 255, 255, 0.03) 40%,
                    rgba(255, 255, 255, 0.08) 50%,
                    rgba(255, 255, 255, 0.03) 60%,
                    transparent 70%
            );
            transform: translateX(-100%) rotate(45deg);
            transition: transform 0.8s ease;
            pointer-events: none;
        }

        .credit-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow:
                    0 30px 60px rgba(0, 0, 0, 0.4),
                    0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .credit-card:hover::after {
            transform: translateX(100%) rotate(45deg);
        }

        .credit-card:active {
            transform: translateY(-4px) scale(0.99);
        }

        /* Card Main Content Area */
        .card-main-content {
            flex: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }

        /* Card Background Patterns */
        .card-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.12;
            pointer-events: none;
            z-index: 1;
        }

        .card-pattern.circles {
            background:
                    radial-gradient(circle at 90% -10%, rgba(255,255,255,0.5) 0%, transparent 35%),
                    radial-gradient(circle at 10% 110%, rgba(255,255,255,0.4) 0%, transparent 35%),
                    radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 0%, transparent 50%);
        }

        .card-pattern.waves {
            background:
                    repeating-linear-gradient(
                            45deg,
                            transparent,
                            transparent 30px,
                            rgba(255,255,255,0.03) 30px,
                            rgba(255,255,255,0.03) 60px
                    );
        }

        .card-pattern.grid {
            background:
                    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px),
                    linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Card Top Row - Bank Info & Chip */
        .card-row-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            z-index: 2;
            margin-bottom: auto;
        }

        /* Bank Info Section - Left Side */
        .card-bank-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .bank-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 800;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.25);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .bank-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }

        .bank-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .card-bank-name {
            font-size: 1rem;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        .card-nickname {
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0.75;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        /* Chip & Contactless Section - Right Side */
        .chip-contactless-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* EMV Chip - Realistic Design */
        .card-chip {
            width: 45px;
            height: 34px;
            background: linear-gradient(145deg, #e8d5a3 0%, #c9a227 20%, #e8d5a3 40%, #c9a227 60%, #e8d5a3 80%, #c9a227 100%);
            border-radius: 6px;
            position: relative;
            box-shadow:
                    0 2px 8px rgba(0,0,0,0.3),
                    inset 0 1px 0 rgba(255,255,255,0.5),
                    inset 0 -1px 0 rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .card-chip::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 75%;
            height: 65%;
            background:
                    linear-gradient(90deg,
                    transparent 0%, transparent 22%,
                    rgba(0,0,0,0.12) 22%, rgba(0,0,0,0.12) 28%,
                    transparent 28%, transparent 47%,
                    rgba(0,0,0,0.15) 47%, rgba(0,0,0,0.15) 53%,
                    transparent 53%, transparent 72%,
                    rgba(0,0,0,0.12) 72%, rgba(0,0,0,0.12) 78%,
                    transparent 78%
                    ),
                    linear-gradient(0deg,
                    transparent 0%, transparent 25%,
                    rgba(0,0,0,0.1) 25%, rgba(0,0,0,0.1) 32%,
                    transparent 32%, transparent 68%,
                    rgba(0,0,0,0.1) 68%, rgba(0,0,0,0.1) 75%,
                    transparent 75%
                    );
            border-radius: 2px;
        }

        /* Contactless Icon */
        .contactless-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.9;
        }

        .contactless-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0) invert(1);
        }

        /* Fallback contactless waves if no image */
        .contactless-waves {
            width: 24px;
            height: 24px;
            position: relative;
        }

        .contactless-waves .wave {
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            border-left-color: transparent;
            border-bottom-color: transparent;
            transform: rotate(-45deg);
        }

        .contactless-waves .wave:nth-child(1) {
            width: 8px;
            height: 8px;
            bottom: 0;
            left: 8px;
        }

        .contactless-waves .wave:nth-child(2) {
            width: 14px;
            height: 14px;
            bottom: 0;
            left: 5px;
        }

        .contactless-waves .wave:nth-child(3) {
            width: 20px;
            height: 20px;
            bottom: 0;
            left: 2px;
        }

        /* Card Middle - Number */
        .card-row-middle {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: auto 0;
            padding: 0.75rem 0;
        }

        .card-number {
            font-family: 'Space Mono', 'Orbitron', monospace;
            font-size: 1.35rem;
            font-weight: 600;
            letter-spacing: 4px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            word-spacing: 8px;
        }

        /* Card Bottom Row */
        .card-row-bottom {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            position: relative;
            z-index: 2;
            margin-top: auto;
        }

        .card-holder-section {
            flex: 1;
        }

        .card-holder-label {
            font-size: 0.55rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin-bottom: 0.2rem;
        }

        .card-holder-name {
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* Network Logo */
        .card-network-section {
            display: flex;
            align-items: flex-end;
        }

        .network-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 55px;
            height: 36px;
        }

        .network-logo img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) brightness(1.1);
        }

        .network-logo-text {
            font-size: 1.1rem;
            font-weight: 800;
            font-style: italic;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* ========================================
           PAYMENT INFO BAR - Bottom of Card
        ======================================== */
        .payment-info-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(10px);
            padding: 0.875rem 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            z-index: 2;
        }

        .date-info-group {
            display: flex;
            gap: 1.5rem;
        }

        .date-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .date-label {
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .date-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            color: #ffffff;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* Status Badge */
        .status-badge {
            padding: 0.5rem 0.875rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .status-badge.urgent {
            background: rgba(239, 68, 68, 0.9);
            color: white;
            animation: urgentPulse 2s ease-in-out infinite;
        }

        .status-badge.warning {
            background: rgba(245, 158, 11, 0.9);
            color: white;
        }

        .status-badge.safe {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }

        .status-badge.paid {
            background: rgba(34, 197, 94, 0.9);
            color: white;
        }

        @keyframes urgentPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
        }

        /* ========================================
           RESPONSIVE CARD STYLES
        ======================================== */
        @media (max-width: 768px) {
            .credit-card {
                border-radius: 16px;
            }

            .card-main-content {
                padding: 1.25rem;
            }

            .bank-logo {
                width: 42px;
                height: 42px;
            }

            .card-bank-name {
                font-size: 0.9rem;
            }

            .card-nickname {
                font-size: 0.7rem;
            }

            .card-chip {
                width: 40px;
                height: 30px;
            }

            .contactless-icon {
                width: 24px;
                height: 24px;
            }

            .card-number {
                font-size: 1.15rem;
                letter-spacing: 3px;
            }

            .card-holder-name {
                font-size: 0.8rem;
                letter-spacing: 1.5px;
            }

            .network-logo {
                width: 48px;
                height: 32px;
            }

            .payment-info-bar {
                padding: 0.75rem 1.25rem;
            }

            .date-info-group {
                gap: 1rem;
            }

            .date-label {
                font-size: 0.55rem;
            }

            .date-value {
                font-size: 0.85rem;
            }

            .status-badge {
                font-size: 0.65rem;
                padding: 0.4rem 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .card-main-content {
                padding: 1rem;
            }

            .bank-logo {
                width: 38px;
                height: 38px;
            }

            .card-bank-name {
                font-size: 0.85rem;
            }

            .card-chip {
                width: 36px;
                height: 26px;
            }

            .card-number {
                font-size: 1rem;
                letter-spacing: 2px;
            }

            .payment-info-bar {
                padding: 0.625rem 1rem;
            }

            .date-info-group {
                gap: 0.75rem;
            }

            .status-badge {
                font-size: 0.6rem;
                padding: 0.35rem 0.625rem;
            }
        }

        /* ========================================
           ADD CARD BUTTON
        ======================================== */

        /* ========================================
           ADD CARD BUTTON
        ======================================== */
        .add-card-btn {
            aspect-ratio: 1.586 / 1;
            border-radius: 20px;
            border: 3px dashed var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            transition: all 0.3s ease;
            color: var(--text-muted);
        }

        .add-card-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }

        .add-card-btn .icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .add-card-btn:hover .icon {
            background: var(--accent-gradient);
            color: white;
            transform: scale(1.1);
        }

        .add-card-btn span {
            font-size: 0.95rem;
            font-weight: 600;
        }

        /* ========================================
           FLOATING ADD BUTTON
        ======================================== */
        .fab-add {
            position: fixed;
            bottom: 28px;
            right: 28px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            border: none;
            color: white;
            font-size: 2.25rem;
            font-weight: 300;
            line-height: 1;
            cursor: pointer;
        }

        .fab-add:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.5);
        }

        .fab-add:active {
            transform: scale(0.95);
        }

        .fab-add.hidden {
            display: none;
        }

        /* ========================================
           MODAL STYLES
        ======================================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1.25rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 24px;
            width: 100%;
            max-width: 520px;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
            border-radius: 24px 24px 0 0;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
        }

        /* ========================================
           CARD ACTIONS MODAL
        ======================================== */
        .card-actions-modal {
            max-width: 380px;
        }

        .card-preview-mini {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-preview-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
        }

        .card-preview-info h4 {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .card-preview-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .card-action-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .card-action-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border-radius: 14px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .card-action-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .card-action-item .action-icon {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .card-action-item .action-icon.paid {
            background: rgba(16, 185, 129, 0.1);
        }

        .card-action-item .action-icon.edit {
            background: rgba(99, 102, 241, 0.1);
        }

        .card-action-item .action-icon.delete {
            background: rgba(239, 68, 68, 0.1);
        }

        .card-action-item .action-text h5 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.125rem;
        }

        .card-action-item .action-text p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .card-action-item.is-paid .action-icon {
            background: var(--success);
            color: white;
        }

        .card-action-item.delete-action:hover {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        /* ========================================
           CONFIRMATION MODAL
        ======================================== */
        .confirm-modal {
            max-width: 400px;
            text-align: center;
        }

        .confirm-modal .modal-body {
            padding: 2.5rem 2rem;
        }

        .confirm-icon {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .confirm-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .confirm-icon.danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .confirm-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .confirm-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .confirm-message {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .confirm-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirm-actions .btn {
            min-width: 120px;
        }

        /* ========================================
           FORM STYLES
        ======================================== */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* ========================================
           BANK SELECTOR
        ======================================== */
        .bank-search-wrapper {
            margin-bottom: 0.75rem;
            position: relative;
        }

        .bank-search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .bank-search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .bank-search-wrapper::before {
            content: 'üîç';
            position: absolute;
            left: 0.875rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            pointer-events: none;
        }

        .bank-selector {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 220px;
            overflow-y: auto;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 2px solid var(--border-color);
        }

        .bank-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
        }

        .bank-option:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .bank-option.selected {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .bank-option.hidden {
            display: none;
        }

        .bank-option-logo {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            overflow: hidden;
        }

        .bank-option-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .bank-option-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .other-bank-input {
            display: none;
            margin-top: 0.75rem;
        }

        .other-bank-input.show {
            display: block;
        }

        /* Color Picker */
        .color-picker-wrapper {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 3px var(--bg-secondary), 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Notification Preferences */
        .notification-prefs {
            background: var(--bg-tertiary);
            border-radius: 14px;
            padding: 1rem;
            border: 2px solid var(--border-color);
        }

        .notification-pref-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .notification-pref-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .notification-pref-item:first-child {
            padding-top: 0;
        }

        .notification-pref-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .reminder-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .reminder-chip {
            padding: 0.5rem 0.875rem;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .reminder-chip:hover {
            border-color: var(--accent-primary);
        }

        .reminder-chip.selected {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        /* ========================================
           TOGGLE SWITCH
        ======================================== */
        .toggle {
            position: relative;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-tertiary);
            border-radius: 28px;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .toggle input:checked + .toggle-slider {
            background: var(--accent-gradient);
            border-color: transparent;
        }

        .toggle input:checked + .toggle-slider::before {
            transform: translateX(22px);
        }

        /* ========================================
           BUTTONS
        ======================================== */
        .btn {
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-block {
            width: 100%;
        }

        /* ========================================
           TIMELINE VIEW
        ======================================== */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--border-color);
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
            padding-left: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 0.5rem;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: 3px solid var(--bg-secondary);
            box-shadow: 0 0 0 3px var(--accent-primary);
        }

        .timeline-item.urgent::before {
            background: var(--danger);
            box-shadow: 0 0 0 3px var(--danger);
        }

        .timeline-item.warning::before {
            background: var(--warning);
            box-shadow: 0 0 0 3px var(--warning);
        }

        .timeline-item.paid::before {
            background: var(--success);
            box-shadow: 0 0 0 3px var(--success);
        }

        .timeline-card {
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .timeline-card:hover {
            box-shadow: var(--card-shadow);
            transform: translateX(5px);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .timeline-title {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 0.35rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .timeline-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .paid-badge {
            background: var(--success);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* ========================================
           CALENDAR VIEW
        ======================================== */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .calendar-month {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            padding: 0.5rem;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .calendar-day:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .calendar-day.today {
            background: var(--accent-gradient);
            color: white;
            border-color: transparent;
        }

        .calendar-day.has-due::after {
            content: '';
            position: absolute;
            bottom: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
        }

        .calendar-day.has-billing::after {
            background: var(--warning);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        /* ========================================
           SETTINGS VIEW
        ======================================== */
        .settings-section {
            background: var(--bg-secondary);
            border-radius: 18px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .settings-section-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .settings-item-info h4 {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .settings-item-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .data-safety-callout {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .data-safety-callout h4 {
            color: var(--warning);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-safety-callout p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        /* Notification Times Grid */
        .notification-times-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            width: 100%;
        }

        .time-checkbox {
            cursor: pointer;
        }

        .time-checkbox input {
            display: none;
        }

        .time-checkbox-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.75rem;
            border-radius: 14px;
            border: 2px solid var(--border-color);
            background: var(--bg-tertiary);
            transition: all 0.2s ease;
            text-align: center;
        }

        .time-checkbox input:checked + .time-checkbox-box {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .time-checkbox:hover .time-checkbox-box {
            border-color: var(--accent-primary);
        }

        .time-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .time-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .time-desc {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.125rem;
        }

        .custom-time-input-wrapper {
            width: 100%;
            display: none;
            flex-direction: column;
            gap: 0.5rem;
        }

        .custom-time-input-wrapper.show {
            display: flex;
        }

        .notification-frequency-selector {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.375rem;
            border-radius: 10px;
        }

        .freq-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .freq-btn:hover {
            background: var(--bg-secondary);
        }

        .freq-btn.active {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .notification-schedule-summary {
            background: var(--bg-tertiary);
            border-radius: 14px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .schedule-summary-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .schedule-times-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .schedule-time-tag {
            background: var(--bg-secondary);
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            font-weight: 600;
        }

        .schedule-time-tag.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .notification-preview {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border: 2px dashed var(--border-color);
        }

        .notification-preview-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .notification-preview-content {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .notification-preview-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .notification-preview-text h5 {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .notification-preview-text p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ========================================
           NOTIFICATION PERMISSION BANNER
        ======================================== */
        .notification-banner {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .notification-banner.hidden {
            display: none;
        }

        .notification-banner-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-banner-icon {
            font-size: 1.5rem;
        }

        .notification-banner h3 {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .notification-banner p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .notification-banner .btn {
            background: white;
            color: var(--accent-primary);
            padding: 0.625rem 1.25rem;
            font-size: 0.9rem;
        }

        /* ========================================
           EMPTY STATE
        ======================================== */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .empty-state p {
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        /* ========================================
           TOAST NOTIFICATIONS
        ======================================== */
        .toast-container {
            position: fixed;
            bottom: 100px;
            right: 1rem;
            left: 1rem;
            z-index: 1100;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 380px;
            width: 100%;
            pointer-events: auto;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }
        .toast.info .toast-icon { color: var(--accent-primary); }

        .toast-message {
            flex: 1;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* ========================================
           RESPONSIVE STYLES
        ======================================== */
        @media (max-width: 768px) {
            .header-content {
                padding: 0;
            }

            .logo-text {
                font-size: 1.25rem;
            }

            .nav-tabs {
                padding: 0.75rem;
                gap: 0.375rem;
            }

            .nav-tab {
                padding: 0.625rem 0.75rem;
                font-size: 0.8rem;
            }

            .nav-tab span {
                display: none;
            }

            .main-content {
                padding: 1rem;
                padding-bottom: 100px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .credit-card {
                padding: 1.25rem;
            }

            .card-number {
                font-size: 1.15rem;
                letter-spacing: 3px;
            }

            .card-holder-name {
                font-size: 0.85rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal {
                max-height: 90vh;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .toast-container {
                bottom: 90px;
            }

            .fab-add {
                bottom: 20px;
                right: 20px;
                width: 56px;
                height: 56px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .card-dates-section {
                gap: 1rem;
            }

            .notification-times-grid {
                gap: 0.5rem;
            }

            .time-checkbox-box {
                padding: 0.75rem 0.5rem;
            }

            .time-icon {
                font-size: 1.25rem;
            }

            .time-label {
                font-size: 0.75rem;
            }

            .time-desc {
                display: none;
            }
        }

        /* ========================================
           SCROLLBAR STYLES
        ======================================== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* ========================================
           PRINT STYLES
        ======================================== */
        @media print {
            .header, .nav-tabs, .add-card-btn, .notification-banner, .fab-add {
                display: none !important;
            }

            .credit-card {
                break-inside: avoid;
                box-shadow: none;
                border: 2px solid #000;
            }
        }
    </style>
</head>
<body>
<!-- Animated Background -->
<div class="bg-animation"></div>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo">
            <div class="logo-icon">üí≥</div>
            <span class="logo-text">CardGuard</span>
        </div>
        <div class="header-actions">
            <button class="icon-btn add-btn" id="headerAddBtn" title="Add Card">+</button>
            <button class="icon-btn" id="themeToggle" title="Toggle Theme">üåô</button>
        </div>
    </div>
</header>

<!-- Navigation Tabs -->
<nav class="nav-tabs">
    <button class="nav-tab active" data-view="dashboard">
        üè† <span>Dashboard</span>
    </button>
    <button class="nav-tab" data-view="timeline">
        üìÖ <span>Timeline</span>
    </button>
    <button class="nav-tab" data-view="calendar">
        üóìÔ∏è <span>Calendar</span>
    </button>
    <button class="nav-tab" data-view="settings">
        ‚öôÔ∏è <span>Settings</span>
    </button>
</nav>

<!-- Main Content -->
<main class="main-content">
    <!-- Notification Permission Banner -->
    <div class="notification-banner" id="notificationBanner">
        <div class="notification-banner-content">
            <span class="notification-banner-icon">üîî</span>
            <div>
                <h3>Enable Notifications</h3>
                <p>Get reminded before your payment due dates</p>
            </div>
        </div>
        <button class="btn" id="enableNotificationsBtn">Enable</button>
    </div>

    <!-- Dashboard View -->
    <section class="view active" id="dashboardView">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary">üí≥</div>
                <div class="stat-value" id="totalCards">0</div>
                <div class="stat-label">Total Cards</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon danger">‚ö†Ô∏è</div>
                <div class="stat-value" id="dueSoon">0</div>
                <div class="stat-label">Due in 3 Days</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning">üìã</div>
                <div class="stat-value" id="billingSoon">0</div>
                <div class="stat-label">Billing Soon</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success">‚úÖ</div>
                <div class="stat-value" id="paidCount">0</div>
                <div class="stat-label">Paid This Month</div>
            </div>
        </div>

        <!-- Cards Section -->
        <div class="section-header">
            <h2 class="section-title">My Credit Cards</h2>
        </div>

        <div class="cards-grid" id="cardsGrid">
            <!-- Cards will be rendered here -->
        </div>
    </section>

    <!-- Timeline View -->
    <section class="view" id="timelineView">
        <div class="section-header">
            <h2 class="section-title">Upcoming Dates</h2>
        </div>
        <div class="timeline" id="timeline">
            <!-- Timeline items will be rendered here -->
        </div>
    </section>

    <!-- Calendar View -->
    <section class="view" id="calendarView">
        <div class="calendar-header">
            <div class="calendar-nav">
                <button class="calendar-nav-btn" id="prevMonth">‚óÄ</button>
                <h2 class="calendar-month" id="calendarMonth"></h2>
                <button class="calendar-nav-btn" id="nextMonth">‚ñ∂</button>
            </div>
            <button class="btn btn-secondary" id="todayBtn">Today</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be rendered here -->
        </div>
    </section>

    <!-- Settings View -->
    <section class="view" id="settingsView">
        <div class="settings-section">
            <h3 class="settings-section-title">üîî Notifications</h3>

            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Push Notifications</h4>
                    <p>Receive browser notifications for reminders</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="pushNotificationsToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Sound Alerts</h4>
                    <p>Play a sound when showing notifications</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="soundAlertsToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Default Reminder Days</h4>
                    <p>Days before due date to remind</p>
                </div>
                <select class="form-select" id="defaultReminderDays" style="width: auto;">
                    <option value="1">1 day</option>
                    <option value="3" selected>3 days</option>
                    <option value="5">5 days</option>
                    <option value="7">7 days</option>
                </select>
            </div>

            <div class="settings-item" style="flex-direction: column; align-items: flex-start; gap: 1rem;">
                <div class="settings-item-info">
                    <h4>Preset Notification Times</h4>
                    <p>Select when to receive daily reminders</p>
                </div>
                <div class="notification-times-grid">
                    <label class="time-checkbox">
                        <input type="checkbox" id="notifyTime9AM">
                        <div class="time-checkbox-box">
                            <span class="time-icon">üåÖ</span>
                            <span class="time-label">Morning</span>
                            <span class="time-desc">9:00 AM</span>
                        </div>
                    </label>
                    <label class="time-checkbox">
                        <input type="checkbox" id="notifyTime2PM">
                        <div class="time-checkbox-box">
                            <span class="time-icon">‚òÄÔ∏è</span>
                            <span class="time-label">Afternoon</span>
                            <span class="time-desc">2:00 PM</span>
                        </div>
                    </label>
                    <label class="time-checkbox">
                        <input type="checkbox" id="notifyTime6PM">
                        <div class="time-checkbox-box">
                            <span class="time-icon">üåÜ</span>
                            <span class="time-label">Evening</span>
                            <span class="time-desc">6:00 PM</span>
                        </div>
                    </label>
                </div>
            </div>

            <div class="settings-item" style="flex-direction: column; align-items: flex-start; gap: 1rem;">
                <div class="settings-item-info" style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                    <div>
                        <h4>Custom Notification Time</h4>
                        <p>Add a specific time you prefer</p>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="enableCustomTime">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="custom-time-input-wrapper" id="customTimeWrapper">
                    <input type="time" id="customNotificationTime" class="form-input" style="font-size: 1.1rem; padding: 0.625rem; border-radius: 10px; text-align: center; max-width: 180px;">
                    <span style="font-size: 0.75rem; color: var(--text-muted);">This will be added to your notification schedule</span>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Max Notifications Per Day</h4>
                    <p>Limit how many times you're notified daily</p>
                </div>
                <div class="notification-frequency-selector">
                    <button class="freq-btn" data-freq="1">1√ó</button>
                    <button class="freq-btn active" data-freq="2">2√ó</button>
                    <button class="freq-btn" data-freq="3">3√ó</button>
                </div>
            </div>

            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>üö® Urgent Due Date Alerts</h4>
                    <p>Get special alerts for cards due today or tomorrow</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="urgentAlertsToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>üìã Consolidated Summary</h4>
                    <p>Combine multiple card reminders into one notification</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="consolidatedSummaryToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="notification-schedule-summary">
                <div class="schedule-summary-title">
                    üìÖ Your Notification Schedule
                </div>
                <div class="schedule-times-list" id="scheduleTimesList">
                </div>
                <div class="notification-preview" id="notificationPreview">
                    <div class="notification-preview-title">Preview</div>
                    <div class="notification-preview-content">
                        <div class="notification-preview-icon">üí≥</div>
                        <div class="notification-preview-text">
                            <h5>CardGuard Reminder</h5>
                            <p id="previewText">You have 2 cards due soon: HDFC (3 days), ICICI (5 days)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-section-title">üé® Appearance</h3>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Dark Mode</h4>
                    <p>Toggle dark/light theme</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-section-title">üíæ Data Management</h3>

            <div class="data-safety-callout">
                <h4>‚ö†Ô∏è Before deleting data</h4>
                <p>Export your cards first to create a backup. You can import this backup anytime.</p>
                <button class="btn btn-secondary" id="exportBeforeDeleteBtn" style="padding: 0.5rem 1rem; font-size: 0.85rem;">üì§ Export Backup Now</button>
            </div>

            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Export Cards</h4>
                    <p>Download all card data as JSON</p>
                </div>
                <button class="btn btn-secondary" id="exportDataBtn">Export</button>
            </div>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Import Cards</h4>
                    <p>Import card data from JSON file</p>
                </div>
                <button class="btn btn-secondary" id="importDataBtn">Import</button>
            </div>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Clear All Data</h4>
                    <p>Delete all cards and settings permanently</p>
                </div>
                <button class="btn btn-danger" id="clearDataBtn">Clear</button>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-section-title">üì± Install App</h3>
            <div class="settings-item">
                <div class="settings-item-info">
                    <h4>Install CardGuard</h4>
                    <p>Add to home screen for quick access</p>
                </div>
                <button class="btn btn-primary" id="installPwaBtn" style="display: none;">Install</button>
            </div>
        </div>
    </section>
</main>

<!-- Floating Add Button -->
<button class="fab-add hidden" id="fabAddBtn" title="Add Card">+</button>

<!-- Add/Edit Card Modal -->
<div class="modal-overlay" id="cardModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Add New Card</h2>
            <button class="modal-close" id="closeModal">‚úï</button>
        </div>
        <div class="modal-body">
            <form id="cardForm">
                <input type="hidden" id="cardId">

                <div class="form-group">
                    <label class="form-label">Card Holder Name *</label>
                    <input type="text" class="form-input" id="cardHolderName" placeholder="Name as on card" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Card Nickname</label>
                    <input type="text" class="form-input" id="cardName" placeholder="e.g., Shopping Card, Travel Card">
                </div>

                <div class="form-group">
                    <label class="form-label">Bank *</label>
                    <div class="bank-search-wrapper">
                        <input type="text" class="bank-search-input" id="bankSearch" placeholder="Search banks...">
                    </div>
                    <div class="bank-selector" id="bankSelector">
                        <!-- Banks will be rendered here -->
                    </div>
                    <div class="other-bank-input" id="otherBankInput">
                        <input type="text" class="form-input" id="customBankName" placeholder="Enter bank name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Card Network *</label>
                        <select class="form-select" id="cardNetwork" required>
                            <option value="visa">Visa</option>
                            <option value="mastercard">MasterCard</option>
                            <option value="rupay">RuPay</option>
                            <option value="amex">American Express</option>
                            <option value="diners">Diners Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last 4 Digits *</label>
                        <input type="text" class="form-input" id="last4Digits" placeholder="1234" maxlength="4" pattern="[0-9]{4}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Billing Date *</label>
                        <select class="form-select" id="billingDate" required>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date *</label>
                        <select class="form-select" id="dueDate" required>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Credit Limit (Optional)</label>
                    <input type="number" class="form-input" id="creditLimit" placeholder="‚Çπ100000">
                </div>

                <div class="form-group">
                    <label class="form-label">Card Color *</label>
                    <div class="color-picker-wrapper" id="colorPicker">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Notification Preferences</label>
                    <div class="notification-prefs">
                        <div class="notification-pref-item">
                            <span class="notification-pref-label">
                                üìã Notify on Billing Date
                            </span>
                            <label class="toggle">
                                <input type="checkbox" id="notifyOnBilling">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-pref-item">
                            <span class="notification-pref-label">
                                üí∞ Notify before Due Date
                            </span>
                            <label class="toggle">
                                <input type="checkbox" id="notifyBeforeDue" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="notification-pref-item" id="reminderDaysContainer">
                            <span class="notification-pref-label">
                                Days before due date
                            </span>
                            <div class="reminder-options" id="reminderOptions">
                                <div class="reminder-chip" data-days="1">1</div>
                                <div class="reminder-chip selected" data-days="3">3</div>
                                <div class="reminder-chip" data-days="5">5</div>
                                <div class="reminder-chip" data-days="7">7</div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
            <button type="submit" form="cardForm" class="btn btn-primary">Save Card</button>
        </div>
    </div>
</div>

<!-- Card Actions Modal -->
<div class="modal-overlay" id="cardActionsModal">
    <div class="modal card-actions-modal">
        <div class="modal-header">
            <h2 class="modal-title">Card Actions</h2>
            <button class="modal-close" id="closeCardActionsModal">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="card-preview-mini" id="cardPreviewMini">
                <div class="card-preview-icon" id="cardPreviewIcon">üí≥</div>
                <div class="card-preview-info">
                    <h4 id="cardPreviewName">HDFC Bank</h4>
                    <p id="cardPreviewDetails">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1234 ‚Ä¢ Due: 15th</p>
                </div>
            </div>
            <div class="card-action-list">
                <div class="card-action-item" id="actionMarkPaid">
                    <div class="action-icon paid">üí∞</div>
                    <div class="action-text">
                        <h5 id="paidActionText">Mark as Paid</h5>
                        <p id="paidActionDesc">Confirm payment for this month</p>
                    </div>
                </div>
                <div class="card-action-item" id="actionEdit">
                    <div class="action-icon edit">‚úèÔ∏è</div>
                    <div class="action-text">
                        <h5>Edit Card</h5>
                        <p>Modify card details</p>
                    </div>
                </div>
                <div class="card-action-item delete-action" id="actionDelete">
                    <div class="action-icon delete">üóëÔ∏è</div>
                    <div class="action-text">
                        <h5>Delete Card</h5>
                        <p>Remove this card permanently</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal confirm-modal">
        <div class="modal-body">
            <div class="confirm-icon success" id="confirmIcon">‚úÖ</div>
            <h3 class="confirm-title" id="confirmTitle">Mark as Paid?</h3>
            <p class="confirm-message" id="confirmMessage">Are you sure you want to mark this card as paid for this month?</p>
            <div class="confirm-actions">
                <button class="btn btn-secondary" id="confirmCancelBtn">Cancel</button>
                <button class="btn btn-success" id="confirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Hidden file input for import -->
<input type="file" id="fileInput" accept=".json" style="display: none;">

<script>
    // ========================================
    // APPLICATION STATE & CONFIGURATION
    // ========================================

    const APP_CONFIG = {
        storageKey: 'cardguard_cards',
        settingsKey: 'cardguard_settings',
        version: '3.0.0'
    };

    // Popular Banks with colors and logos
    const POPULAR_BANKS = [
        { id: 'hdfc', name: 'HDFC Bank', color: '#ffffff', abbr: 'HDFC', logoUrl: 'HDFCBankLogo.png' },
        { id: 'sbi', name: 'SBI', color: '#ffffff', abbr: 'SBI', logoUrl: 'SBIBankLogo.png' },
        { id: 'icici', name: 'ICICI Bank', color: '#ffffff', abbr: 'ICICI', logoUrl: 'ICICIBankLogo.png' },
        { id: 'axis', name: 'Axis Bank', color: '#ffffff', abbr: 'AXIS', logoUrl: 'AxisBankLogo.png' },
        { id: 'kotak', name: 'Kotak Mahindra Bank', color: '#ffffff', abbr: 'KTK', logoUrl: 'KotakBankLogo.png' },
        { id: 'rbl', name: 'RBL Bank', color: '#ffffff', abbr: 'RBL', logoUrl: 'RBLBankLogo.png' },
        { id: 'indusind', name: 'IndusInd Bank', color: '#ffffff', abbr: 'IIB', logoUrl: 'IndusIndBankLogo.webp' },
        { id: 'idfc', name: 'IDFC First Bank', color: '#ffffff', abbr: 'IDFC', logoUrl: 'IDFCBankLogo.png' },
        { id: 'amex', name: 'American Express', color: '#ffffff', abbr: 'AMEX', logoUrl: 'AmericanExpressBankLogo.png' },
        { id: 'yes', name: 'YES Bank', color: '#ffffff', abbr: 'YES', logoUrl: 'YESBankLogo.png' },
        { id: 'sc', name: 'Standard Chartered Bank', color: '#ffffff', abbr: 'SC', logoUrl: 'StandardCharteredBankLogo.png' },
        { id: 'citi', name: 'Citibank', color: '#ffffff', abbr: 'CITI', logoUrl: 'CitiBankLogo.png' },
        { id: 'hsbc', name: 'HSBC Bank', color: '#ffffff', abbr: 'HSBC', logoUrl: 'HSBCBankLogo.png' },
        { id: 'federal', name: 'Federal Bank', color: '#ffffff', abbr: 'FED', logoUrl: 'FederalBankLogo.webp' },
        { id: 'union', name: 'Union Bank of India', color: '#ffffff', abbr: 'UBI', logoUrl: 'UnionBankLogo.png' },
        { id: 'canara', name: 'Canara Bank', color: '#ffffff', abbr: 'CAN', logoUrl: 'CanaraBankLogo.png' },
        { id: 'pnb', name: 'Punjab National Bank', color: '#ffffff', abbr: 'PNB', logoUrl: 'PNBBankLogo.png' },
        { id: 'bob', name: 'Bank of Baroda', color: '#ffffff', abbr: 'BOB', logoUrl: 'BankOfBarodaBankLogo.png' },
        { id: 'au', name: 'AU Small Finance Bank', color: '#ffffff', abbr: 'AU', logoUrl: 'AUSmallFinanceBankLogo.png' },
        { id: 'slice', name: 'Slice', color: '#ffffff', abbr: 'SLCE', logoUrl: 'SliceBankLogo.png' },
        { id: 'sbm', name: 'SBM Bank', color: '#ffffff', abbr: 'SBM', logoUrl: 'SBMBankLogo.png' },
        { id: 'unity', name: 'Unity Small Finance Bank', color: '#ffffff', abbr: 'UNTY', logoUrl: 'UnitySmallFinanceBankLogo.png' },
        { id: 'utkarsh', name: 'Utkarsh Small Finance Bank', color: '#ffffff', abbr: 'UTKS', logoUrl: 'UtkarshSmallFinanceBankLogo.png' },
        { id: 'other', name: 'Other Bank', color: '#ffffff', abbr: '...', logoUrl: null }
    ];

    // Card color gradients - Premium designs
    const CARD_COLORS = [
        { id: 'midnight', gradient: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)' },
        { id: 'ocean', gradient: 'linear-gradient(135deg, #0077b6 0%, #00b4d8 50%, #90e0ef 100%)' },
        { id: 'sunset', gradient: 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)' },
        { id: 'forest', gradient: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' },
        { id: 'purple', gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
        { id: 'rose', gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
        { id: 'gold', gradient: 'linear-gradient(135deg, #f7971e 0%, #ffd200 100%)' },
        { id: 'slate', gradient: 'linear-gradient(135deg, #485563 0%, #29323c 100%)' },
        { id: 'royal', gradient: 'linear-gradient(135deg, #141e30 0%, #243b55 100%)' },
        { id: 'cherry', gradient: 'linear-gradient(135deg, #eb3349 0%, #f45c43 100%)' }
    ];

    const CARD_PATTERNS = ['circles', 'waves', 'grid'];

    const DEFAULT_NOTIFICATION_TIMES = {
        morning: { hour: 9, minute: 0, label: '9:00 AM', icon: 'üåÖ' },
        afternoon: { hour: 14, minute: 0, label: '2:00 PM', icon: '‚òÄÔ∏è' },
        evening: { hour: 18, minute: 0, label: '6:00 PM', icon: 'üåÜ' }
    };

    // Application state
    let state = {
        cards: [],
        settings: {
            pushNotifications: false,
            soundAlerts: true,
            defaultReminderDays: 3,
            darkMode: false,
            notificationTimes: {
                morning: true,
                afternoon: false,
                evening: false
            },
            customTimeEnabled: false,
            customTime: '10:00',
            maxNotificationsPerDay: 2,
            urgentAlerts: true,
            consolidatedSummary: true
        },
        currentView: 'dashboard',
        editingCardId: null,
        selectedColor: CARD_COLORS[0].id,
        selectedBank: null,
        selectedReminder: 3,
        calendarDate: new Date(),
        notificationsSentToday: 0,
        lastNotificationDate: null,
        activeCardId: null
    };

    let deferredPrompt = null;
    let schedulerIntervalId = null;
    let usedTimeSlots = {};
    let confirmCallback = null;

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================

    function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function getDaysUntil(dayOfMonth) {
        const today = new Date();
        const currentDay = today.getDate();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();

        let targetDate = new Date(currentYear, currentMonth, dayOfMonth);

        if (dayOfMonth <= currentDay) {
            targetDate = new Date(currentYear, currentMonth + 1, dayOfMonth);
        }

        const diffTime = targetDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        return diffDays;
    }

    function getCurrentBillingCycle() {
        const today = new Date();
        return today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
    }

    function getOrdinal(n) {
        const s = ['th', 'st', 'nd', 'rd'];
        const v = n % 100;
        return n + (s[(v - 20) % 10] || s[v] || s[0]);
    }

    function getDueStatus(daysUntil, isPaid) {
        if (isPaid) return { class: 'paid', text: '‚úì PAID' };
        if (daysUntil <= 0) return { class: 'urgent', text: 'DUE TODAY!' };
        if (daysUntil === 1) return { class: 'urgent', text: 'DUE TOMORROW' };
        if (daysUntil <= 3) return { class: 'urgent', text: daysUntil + ' DAYS LEFT' };
        if (daysUntil <= 7) return { class: 'warning', text: daysUntil + ' DAYS LEFT' };
        return { class: 'safe', text: daysUntil + ' DAYS LEFT' };
    }

    function isCardPaidThisCycle(card) {
        const currentCycle = getCurrentBillingCycle();
        return card.paidCycles && card.paidCycles.includes(currentCycle);
    }

    function populateDateSelects() {
        const billingDateSelect = document.getElementById('billingDate');
        const dueDateSelect = document.getElementById('dueDate');

        billingDateSelect.innerHTML = '';
        dueDateSelect.innerHTML = '';

        for (let i = 1; i <= 31; i++) {
            const option1 = document.createElement('option');
            option1.value = i;
            option1.textContent = getOrdinal(i);
            billingDateSelect.appendChild(option1);

            const option2 = document.createElement('option');
            option2.value = i;
            option2.textContent = getOrdinal(i);
            dueDateSelect.appendChild(option2);
        }
    }

    function formatTime12Hour(time24) {
        if (!time24) return '--:--';
        const parts = time24.split(':');
        const hours = parseInt(parts[0]);
        const minutes = parseInt(parts[1]);
        const period = hours >= 12 ? 'PM' : 'AM';
        const hours12 = hours % 12 || 12;
        return hours12 + ':' + String(minutes).padStart(2, '0') + ' ' + period;
    }

    function getTodayDateString() {
        return new Date().toDateString();
    }

    function getNetworkLogo(network) {
        const logos = {
            visa: '<div class="network-logo"><img src="visalogo.png" alt="Visa" onerror="this.parentElement.innerHTML=\'<span class=network-logo-text>VISA</span>\'" /></div>',
            mastercard: '<div class="network-logo"><img src="mastercardlogo.png" alt="MasterCard" onerror="this.parentElement.innerHTML=\'<span class=network-logo-text>MC</span>\'" /></div>',
            rupay: '<div class="network-logo"><img src="rupaylogo.png" alt="RuPay" onerror="this.parentElement.innerHTML=\'<span class=network-logo-text>RuPay</span>\'" /></div>',
            amex: '<div class="network-logo"><img src="amexlogo.png" alt="Amex" onerror="this.parentElement.innerHTML=\'<span class=network-logo-text>AMEX</span>\'" /></div>',
            diners: '<div class="network-logo"><img src="dinerslogo.png" alt="Diners" onerror="this.parentElement.innerHTML=\'<span class=network-logo-text>DINERS</span>\'" /></div>'
        };
        return logos[network] || logos.visa;
    }

    // ========================================
    // LOCAL STORAGE FUNCTIONS
    // ========================================

    function loadCards() {
        try {
            const data = localStorage.getItem(APP_CONFIG.storageKey);
            state.cards = data ? JSON.parse(data) : [];
        } catch (e) {
            console.error('Error loading cards:', e);
            state.cards = [];
        }
    }

    function saveCards() {
        try {
            localStorage.setItem(APP_CONFIG.storageKey, JSON.stringify(state.cards));
        } catch (e) {
            console.error('Error saving cards:', e);
            showToast('Error saving data', 'error');
        }
    }

    function loadSettings() {
        try {
            const data = localStorage.getItem(APP_CONFIG.settingsKey);
            if (data) {
                const savedSettings = JSON.parse(data);
                state.settings = {
                    ...state.settings,
                    ...savedSettings,
                    notificationTimes: {
                        ...state.settings.notificationTimes,
                        ...(savedSettings.notificationTimes || {})
                    }
                };
            }
        } catch (e) {
            console.error('Error loading settings:', e);
        }

        const lastNotifDate = localStorage.getItem('cardguard_lastnotifdate');
        const notifCount = localStorage.getItem('cardguard_notifcount');

        if (lastNotifDate === getTodayDateString()) {
            state.notificationsSentToday = parseInt(notifCount) || 0;
        } else {
            state.notificationsSentToday = 0;
        }
        state.lastNotificationDate = lastNotifDate;

        const savedSlots = localStorage.getItem('cardguard_usedslots');
        const slotsDate = localStorage.getItem('cardguard_slotsdate');

        if (slotsDate === getTodayDateString() && savedSlots) {
            try {
                usedTimeSlots = JSON.parse(savedSlots);
            } catch (e) {
                usedTimeSlots = {};
            }
        } else {
            usedTimeSlots = {};
        }
    }

    function saveSettings() {
        try {
            localStorage.setItem(APP_CONFIG.settingsKey, JSON.stringify(state.settings));
        } catch (e) {
            console.error('Error saving settings:', e);
        }
    }

    function saveNotificationCount() {
        localStorage.setItem('cardguard_lastnotifdate', getTodayDateString());
        localStorage.setItem('cardguard_notifcount', state.notificationsSentToday.toString());
    }

    function saveUsedTimeSlots() {
        localStorage.setItem('cardguard_slotsdate', getTodayDateString());
        localStorage.setItem('cardguard_usedslots', JSON.stringify(usedTimeSlots));
    }

    // ========================================
    // CONFIRMATION MODAL
    // ========================================

    function showConfirmModal(title, message, iconType, okBtnClass, callback) {
        const modal = document.getElementById('confirmModal');
        const iconEl = document.getElementById('confirmIcon');
        const titleEl = document.getElementById('confirmTitle');
        const messageEl = document.getElementById('confirmMessage');
        const okBtn = document.getElementById('confirmOkBtn');

        titleEl.textContent = title;
        messageEl.textContent = message;

        iconEl.className = 'confirm-icon ' + iconType;
        if (iconType === 'success') {
            iconEl.textContent = '‚úÖ';
        } else if (iconType === 'danger') {
            iconEl.textContent = '‚ö†Ô∏è';
        } else if (iconType === 'warning') {
            iconEl.textContent = '‚ö†Ô∏è';
        }

        okBtn.className = 'btn ' + okBtnClass;

        confirmCallback = callback;
        modal.classList.add('active');
    }

    function hideConfirmModal() {
        document.getElementById('confirmModal').classList.remove('active');
        confirmCallback = null;
    }

    // ========================================
    // CARD ACTIONS MODAL
    // ========================================

    function openCardActionsModal(cardId) {
        const card = state.cards.find(function(c) { return c.id === cardId; });
        if (!card) return;

        state.activeCardId = cardId;
        const isPaid = isCardPaidThisCycle(card);
        const colorConfig = CARD_COLORS.find(function(c) { return c.id === card.color; }) || CARD_COLORS[0];

        document.getElementById('cardPreviewIcon').style.background = colorConfig.gradient;
        document.getElementById('cardPreviewName').textContent = card.cardName || card.bankName;
        document.getElementById('cardPreviewDetails').textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ' + card.last4Digits + ' ‚Ä¢ Due: ' + getOrdinal(card.dueDate);

        const paidActionItem = document.getElementById('actionMarkPaid');
        const paidActionText = document.getElementById('paidActionText');
        const paidActionDesc = document.getElementById('paidActionDesc');

        if (isPaid) {
            paidActionItem.classList.add('is-paid');
            paidActionText.textContent = 'Mark as Unpaid';
            paidActionDesc.textContent = 'Remove paid status for this month';
        } else {
            paidActionItem.classList.remove('is-paid');
            paidActionText.textContent = 'Mark as Paid';
            paidActionDesc.textContent = 'Confirm payment for this month';
        }

        document.getElementById('cardActionsModal').classList.add('active');
    }

    function closeCardActionsModal() {
        document.getElementById('cardActionsModal').classList.remove('active');
        state.activeCardId = null;
    }

    // ========================================
    // NOTIFICATION SYSTEM
    // ========================================

    async function requestNotificationPermission() {
        if (!('Notification' in window)) {
            showToast('Notifications not supported in this browser', 'error');
            return false;
        }

        try {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                state.settings.pushNotifications = true;
                saveSettings();
                updateNotificationBanner();
                document.getElementById('pushNotificationsToggle').checked = true;
                showToast('Notifications enabled!', 'success');
                startNotificationScheduler();
                return true;
            } else {
                showToast('Notification permission denied', 'warning');
                return false;
            }
        } catch (e) {
            console.error('Error requesting notification permission:', e);
            return false;
        }
    }

    function getSelectedNotificationTimes() {
        const times = [];

        if (state.settings.notificationTimes.morning) {
            times.push({
                hour: DEFAULT_NOTIFICATION_TIMES.morning.hour,
                minute: DEFAULT_NOTIFICATION_TIMES.morning.minute,
                label: DEFAULT_NOTIFICATION_TIMES.morning.label,
                icon: DEFAULT_NOTIFICATION_TIMES.morning.icon,
                type: 'preset',
                id: 'morning'
            });
        }
        if (state.settings.notificationTimes.afternoon) {
            times.push({
                hour: DEFAULT_NOTIFICATION_TIMES.afternoon.hour,
                minute: DEFAULT_NOTIFICATION_TIMES.afternoon.minute,
                label: DEFAULT_NOTIFICATION_TIMES.afternoon.label,
                icon: DEFAULT_NOTIFICATION_TIMES.afternoon.icon,
                type: 'preset',
                id: 'afternoon'
            });
        }
        if (state.settings.notificationTimes.evening) {
            times.push({
                hour: DEFAULT_NOTIFICATION_TIMES.evening.hour,
                minute: DEFAULT_NOTIFICATION_TIMES.evening.minute,
                label: DEFAULT_NOTIFICATION_TIMES.evening.label,
                icon: DEFAULT_NOTIFICATION_TIMES.evening.icon,
                type: 'preset',
                id: 'evening'
            });
        }

        if (state.settings.customTimeEnabled && state.settings.customTime) {
            const parts = state.settings.customTime.split(':');
            const hour = parseInt(parts[0]);
            const minute = parseInt(parts[1]);
            times.push({
                hour: hour,
                minute: minute,
                label: formatTime12Hour(state.settings.customTime),
                icon: '‚è∞',
                type: 'custom',
                id: 'custom'
            });
        }

        times.sort(function(a, b) {
            return (a.hour * 60 + a.minute) - (b.hour * 60 + b.minute);
        });

        return times;
    }

    function getCardsNeedingReminder() {
        const reminderCards = [];
        const urgentCards = [];

        for (let i = 0; i < state.cards.length; i++) {
            const card = state.cards[i];

            if (isCardPaidThisCycle(card)) {
                continue;
            }

            const daysUntilDue = getDaysUntil(card.dueDate);

            if (daysUntilDue >= 0 && daysUntilDue <= 1) {
                urgentCards.push({ card: card, daysUntil: daysUntilDue });
                continue;
            }

            if (card.notifyBeforeDue === false) {
                continue;
            }

            const reminderDays = card.reminderDays || [state.settings.defaultReminderDays];

            let shouldRemind = false;
            for (let j = 0; j < reminderDays.length; j++) {
                if (daysUntilDue === reminderDays[j]) {
                    shouldRemind = true;
                    break;
                }
            }

            if (!shouldRemind && daysUntilDue === state.settings.defaultReminderDays) {
                shouldRemind = true;
            }

            if (shouldRemind) {
                reminderCards.push({ card: card, daysUntil: daysUntilDue });
            }
        }

        return { urgentCards: urgentCards, reminderCards: reminderCards };
    }

    function playNotificationSound(isUrgent) {
        if (!state.settings.soundAlerts) {
            return;
        }

        try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;

            const audioContext = new AudioContext();

            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = isUrgent ? 880 : 660;
            oscillator.type = 'sine';

            const now = audioContext.currentTime;
            gainNode.gain.setValueAtTime(0.3, now);

            if (isUrgent) {
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.setValueAtTime(0, now + 0.15);
                gainNode.gain.setValueAtTime(0.3, now + 0.25);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.45);
                oscillator.start(now);
                oscillator.stop(now + 0.5);
            } else {
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.35);
            }

            oscillator.onended = function() {
                audioContext.close();
            };

        } catch (e) {
            console.log('Sound error:', e.message);
        }
    }

    function sendNotification(title, body, tag, isUrgent) {
        if (Notification.permission !== 'granted') {
            return false;
        }

        try {
            const notification = new Notification(title, {
                body: body,
                tag: tag,
                requireInteraction: isUrgent
            });

            notification.onclick = function() {
                window.focus();
                notification.close();
            };

            setTimeout(function() {
                notification.close();
            }, 15000);

            playNotificationSound(isUrgent);

            state.notificationsSentToday++;
            saveNotificationCount();

            return true;

        } catch (error) {
            console.error('Notification error:', error);
            return false;
        }
    }

    function sendConsolidatedNotification(cards, isUrgent) {
        if (cards.length === 0) return false;

        let title, body;

        if (cards.length === 1) {
            const item = cards[0];
            const card = item.card;
            const daysUntil = item.daysUntil;
            const cardName = card.cardName || card.bankName;

            if (isUrgent) {
                title = 'üö® URGENT: ' + cardName;
                body = daysUntil === 0 ? 'Payment is due TODAY!' : 'Payment is due TOMORROW!';
            } else {
                title = 'üí≥ ' + cardName + ' Reminder';
                body = 'Payment due in ' + daysUntil + ' days (' + getOrdinal(card.dueDate) + ')';
            }
        } else {
            title = isUrgent ? 'üö® URGENT: ' + cards.length + ' Cards!' : 'üí≥ ' + cards.length + ' Cards Due Soon';

            const parts = [];
            for (let i = 0; i < Math.min(cards.length, 3); i++) {
                const item = cards[i];
                parts.push((item.card.cardName || item.card.bankName) + ' (' + item.daysUntil + 'd)');
            }
            body = parts.join(', ');
            if (cards.length > 3) {
                body += ' +' + (cards.length - 3) + ' more';
            }
        }

        const tag = isUrgent ? 'urgent-' + Date.now() : 'reminder-' + Date.now();
        return sendNotification(title, body, tag, isUrgent);
    }

    function startNotificationScheduler() {
        if (schedulerIntervalId) {
            clearInterval(schedulerIntervalId);
        }

        schedulerIntervalId = setInterval(function() {
            runScheduledCheck();
        }, 30 * 1000);

        runScheduledCheck();
    }

    function runScheduledCheck() {
        if (!state.settings.pushNotifications) return;
        if (Notification.permission !== 'granted') return;
        if (state.cards.length === 0) return;

        if (state.lastNotificationDate !== getTodayDateString()) {
            state.notificationsSentToday = 0;
            state.lastNotificationDate = getTodayDateString();
            usedTimeSlots = {};
            saveNotificationCount();
            saveUsedTimeSlots();
        }

        if (state.notificationsSentToday >= state.settings.maxNotificationsPerDay) return;

        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTotalMinutes = currentHour * 60 + currentMinute;

        const selectedTimes = getSelectedNotificationTimes();
        let matched = false;
        let slotKey = null;

        for (let i = 0; i < selectedTimes.length; i++) {
            const time = selectedTimes[i];
            const timeTotalMinutes = time.hour * 60 + time.minute;
            const difference = Math.abs(currentTotalMinutes - timeTotalMinutes);

            if (difference <= 5) {
                slotKey = time.id + '_' + time.hour + '_' + time.minute;

                if (usedTimeSlots[slotKey]) {
                    continue;
                }

                matched = true;
                break;
            }
        }

        if (!matched) return;

        usedTimeSlots[slotKey] = true;
        saveUsedTimeSlots();

        const cardsInfo = getCardsNeedingReminder();

        if (cardsInfo.urgentCards.length === 0 && cardsInfo.reminderCards.length === 0) return;

        if (state.settings.urgentAlerts && cardsInfo.urgentCards.length > 0) {
            if (state.settings.consolidatedSummary) {
                sendConsolidatedNotification(cardsInfo.urgentCards, true);
            } else {
                for (let i = 0; i < cardsInfo.urgentCards.length; i++) {
                    if (state.notificationsSentToday >= state.settings.maxNotificationsPerDay) break;
                    const item = cardsInfo.urgentCards[i];
                    const title = 'üö® URGENT: ' + (item.card.cardName || item.card.bankName);
                    const body = item.daysUntil === 0 ? 'Due TODAY!' : 'Due TOMORROW!';
                    sendNotification(title, body, 'urgent-' + item.card.id, true);
                }
            }
        }

        if (cardsInfo.reminderCards.length > 0 && state.notificationsSentToday < state.settings.maxNotificationsPerDay) {
            if (state.settings.consolidatedSummary) {
                sendConsolidatedNotification(cardsInfo.reminderCards, false);
            } else {
                for (let i = 0; i < cardsInfo.reminderCards.length; i++) {
                    if (state.notificationsSentToday >= state.settings.maxNotificationsPerDay) break;
                    const item = cardsInfo.reminderCards[i];
                    const title = 'üí≥ ' + (item.card.cardName || item.card.bankName);
                    const body = 'Due in ' + item.daysUntil + ' days';
                    sendNotification(title, body, 'due-' + item.card.id, false);
                }
            }
        }
    }

    // ========================================
    // SCHEDULE PREVIEW
    // ========================================

    function updateSchedulePreview() {
        const timesList = document.getElementById('scheduleTimesList');
        const previewText = document.getElementById('previewText');

        if (!timesList || !previewText) return;

        const selectedTimes = getSelectedNotificationTimes();

        if (selectedTimes.length === 0) {
            timesList.innerHTML = '<span class="schedule-time-tag">No times selected</span>';
        } else {
            let html = '';
            for (let i = 0; i < selectedTimes.length; i++) {
                const time = selectedTimes[i];
                html += '<span class="schedule-time-tag active">' + time.icon + ' ' + time.label + '</span>';
            }
            timesList.innerHTML = html;
        }

        const cardsInfo = getCardsNeedingReminder();
        const allCards = cardsInfo.urgentCards.concat(cardsInfo.reminderCards);

        if (allCards.length === 0) {
            previewText.textContent = 'No upcoming reminders. All cards paid! üéâ';
        } else if (state.settings.consolidatedSummary && allCards.length > 1) {
            const parts = [];
            for (let i = 0; i < Math.min(allCards.length, 3); i++) {
                parts.push((allCards[i].card.cardName || allCards[i].card.bankName) + ' (' + allCards[i].daysUntil + 'd)');
            }
            previewText.textContent = allCards.length + ' cards due: ' + parts.join(', ') + (allCards.length > 3 ? '...' : '');
        } else if (allCards.length > 0) {
            const item = allCards[0];
            const name = item.card.cardName || item.card.bankName;
            previewText.textContent = item.daysUntil === 0 ? name + ' due TODAY!' : name + ' due in ' + item.daysUntil + ' day(s)';
        }
    }

    // ========================================
    // UI RENDERING FUNCTIONS
    // ========================================

    function renderBankSelector() {
        const selector = document.getElementById('bankSelector');
        let html = '';

        for (let i = 0; i < POPULAR_BANKS.length; i++) {
            const bank = POPULAR_BANKS[i];
            const selected = state.selectedBank === bank.id ? 'selected' : '';
            let logoContent = bank.logoUrl ? '<img src="' + bank.logoUrl + '" alt="' + bank.abbr + '" onerror="this.style.display=\'none\';this.parentElement.textContent=\'' + bank.abbr + '\'">' : bank.abbr;

            html += '<div class="bank-option ' + selected + '" data-bank="' + bank.id + '" data-name="' + bank.name.toLowerCase() + '">';
            html += '<div class="bank-option-logo" style="background:' + bank.color + ';">' + logoContent + '</div>';
            html += '<span class="bank-option-name">' + bank.name + '</span></div>';
        }

        selector.innerHTML = html;

        const options = selector.querySelectorAll('.bank-option');
        for (let i = 0; i < options.length; i++) {
            options[i].addEventListener('click', function() {
                selectBank(this.dataset.bank);
            });
        }
    }

    function selectBank(bankId) {
        state.selectedBank = bankId;
        const options = document.querySelectorAll('.bank-option');
        for (let i = 0; i < options.length; i++) {
            options[i].classList.toggle('selected', options[i].dataset.bank === bankId);
        }

        const otherInput = document.getElementById('otherBankInput');
        if (bankId === 'other') {
            otherInput.classList.add('show');
            document.getElementById('customBankName').focus();
        } else {
            otherInput.classList.remove('show');
        }
    }

    function filterBanks(searchTerm) {
        const options = document.querySelectorAll('.bank-option');
        const term = searchTerm.toLowerCase().trim();

        for (let i = 0; i < options.length; i++) {
            const bankName = options[i].dataset.name;
            if (term === '' || bankName.includes(term)) {
                options[i].classList.remove('hidden');
            } else {
                options[i].classList.add('hidden');
            }
        }
    }

    function getBankInfo(card) {
        if (card.bankId && card.bankId !== 'other') {
            for (let i = 0; i < POPULAR_BANKS.length; i++) {
                if (POPULAR_BANKS[i].id === card.bankId) return POPULAR_BANKS[i];
            }
        }
        return { name: card.bankName, color: '#6366f1', abbr: card.bankName ? card.bankName.substring(0, 4).toUpperCase() : 'BANK', logoUrl: null };
    }

    function renderCards() {
        const grid = document.getElementById('cardsGrid');

        if (state.cards.length === 0) {
            grid.innerHTML = '<div class="add-card-btn" onclick="openAddCardModal()"><div class="icon">‚ûï</div><span>Add Your First Card</span></div>';
            updateStats();
            return;
        }

        const sortedCards = state.cards.slice().sort(function(a, b) {
            const aIsPaid = isCardPaidThisCycle(a);
            const bIsPaid = isCardPaidThisCycle(b);
            if (aIsPaid !== bIsPaid) return aIsPaid ? 1 : -1;
            return getDaysUntil(a.dueDate) - getDaysUntil(b.dueDate);
        });

        let html = '';
        for (let i = 0; i < sortedCards.length; i++) {
            html += createCardHTML(sortedCards[i]);
        }

        html += '<div class="add-card-btn" onclick="openAddCardModal()"><div class="icon">‚ûï</div><span>Add New Card</span></div>';
        grid.innerHTML = html;
        updateStats();
    }

    function createCardHTML(card) {
        const colorConfig = CARD_COLORS.find(function(c) { return c.id === card.color; }) || CARD_COLORS[0];
        const bankInfo = getBankInfo(card);
        const daysUntilDue = getDaysUntil(card.dueDate);
        const isPaid = isCardPaidThisCycle(card);
        const dueStatus = getDueStatus(daysUntilDue, isPaid);
        const pattern = CARD_PATTERNS[Math.floor(card.id.charCodeAt(0) % CARD_PATTERNS.length)];
        const networkLogo = getNetworkLogo(card.network);

        let logoContent = bankInfo.logoUrl
            ? '<img src="' + bankInfo.logoUrl + '" alt="' + bankInfo.abbr + '" onerror="this.style.display=\'none\';this.parentElement.innerHTML=\'' + bankInfo.abbr + '\'">'
            : bankInfo.abbr;

        let html = '';

        // Credit Card Container
        html += '<div class="credit-card" style="background:' + colorConfig.gradient + ';" onclick="openCardActionsModal(\'' + card.id + '\')">';

        // Pattern overlay
        html += '<div class="card-pattern ' + pattern + '"></div>';

        // Main Content Area
        html += '<div class="card-main-content">';

        // Top Row - Bank Info on left, Chip & Contactless on right
        html += '<div class="card-row-top">';

        // Bank info section
        html += '<div class="card-bank-info">';
        html += '<div class="bank-logo" style="background:' + bankInfo.color + ';">' + logoContent + '</div>';
        html += '<div class="bank-details">';
        html += '<div class="card-bank-name">' + bankInfo.name + '</div>';
        if (card.cardName) {
            html += '<div class="card-nickname">' + card.cardName + '</div>';
        }
        html += '</div>';
        html += '</div>';

        // Chip and contactless section
        html += '<div class="chip-contactless-section">';
        html += '<div class="card-chip"></div>';
        html += '<div class="contactless-icon">';
        html += '<img src="NFCIcon.png" alt="NFC" onerror="this.parentElement.innerHTML=\'<div class=contactless-waves><div class=wave></div><div class=wave></div><div class=wave></div></div>\'">';
        html += '</div>';
        html += '</div>';

        html += '</div>'; // End card-row-top

        // Middle Row - Card Number
        html += '<div class="card-row-middle">';
        html += '<div class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ' + card.last4Digits + '</div>';
        html += '</div>';

        // Bottom Row - Cardholder & Network
        html += '<div class="card-row-bottom">';

        // Cardholder
        html += '<div class="card-holder-section">';
        html += '<div class="card-holder-label">Card Holder</div>';
        html += '<div class="card-holder-name">' + (card.cardHolderName || 'CARD HOLDER') + '</div>';
        html += '</div>';

        // Network logo
        html += '<div class="card-network-section">' + networkLogo + '</div>';

        html += '</div>'; // End card-row-bottom

        html += '</div>'; // End card-main-content

        // Payment Info Bar at Bottom
        html += '<div class="payment-info-bar">';
        html += '<div class="date-info-group">';
        html += '<div class="date-item">';
        html += '<span class="date-label">Bill Date</span>';
        html += '<span class="date-value">' + getOrdinal(card.billingDate) + '</span>';
        html += '</div>';
        html += '<div class="date-item">';
        html += '<span class="date-label">Due Date</span>';
        html += '<span class="date-value">' + getOrdinal(card.dueDate) + '</span>';
        html += '</div>';
        html += '</div>';
        html += '<div class="status-badge ' + dueStatus.class + '">' + dueStatus.text + '</div>';
        html += '</div>'; // End payment-info-bar

        html += '</div>'; // End credit-card

        return html;
    }

    function handleMarkPaidAction() {
        if (!state.activeCardId) return;

        const card = state.cards.find(function(c) { return c.id === state.activeCardId; });
        if (!card) return;

        const isPaid = isCardPaidThisCycle(card);
        const cardName = card.cardName || card.bankName;

        closeCardActionsModal();

        if (isPaid) {
            showConfirmModal(
                'Mark as Unpaid?',
                'Remove paid status for "' + cardName + '" this month?',
                'warning',
                'btn-danger',
                function() {
                    togglePaidStatus(card.id);
                    hideConfirmModal();
                }
            );
        } else {
            showConfirmModal(
                'Mark as Paid?',
                'Confirm payment for "' + cardName + '" this month?',
                'success',
                'btn-success',
                function() {
                    togglePaidStatus(card.id);
                    hideConfirmModal();
                }
            );
        }
    }

    function handleEditAction() {
        if (!state.activeCardId) return;
        const cardId = state.activeCardId;
        closeCardActionsModal();

        // Small delay to let the actions modal close first
        setTimeout(function() {
            openEditCardModal(cardId);
        }, 100);
    }

    function handleDeleteAction() {
        if (!state.activeCardId) return;

        const card = state.cards.find(function(c) { return c.id === state.activeCardId; });
        if (!card) return;

        const cardName = card.cardName || card.bankName;
        const cardId = state.activeCardId;

        closeCardActionsModal();

        showConfirmModal(
            'Delete Card?',
            'Are you sure you want to delete "' + cardName + '"? This action cannot be undone.',
            'danger',
            'btn-danger',
            function() {
                deleteCard(cardId);
                hideConfirmModal();
            }
        );
    }

    function togglePaidStatus(cardId) {
        let card = null;
        for (let i = 0; i < state.cards.length; i++) {
            if (state.cards[i].id === cardId) { card = state.cards[i]; break; }
        }
        if (!card) return;

        const currentCycle = getCurrentBillingCycle();
        if (!card.paidCycles) card.paidCycles = [];

        const idx = card.paidCycles.indexOf(currentCycle);
        if (idx === -1) {
            card.paidCycles.push(currentCycle);
            showToast((card.cardName || card.bankName) + ' marked as paid! üéâ', 'success');
        } else {
            card.paidCycles.splice(idx, 1);
            showToast((card.cardName || card.bankName) + ' marked as unpaid', 'info');
        }

        saveCards();
        renderCards();
        renderTimeline();
        updateSchedulePreview();
    }

    function deleteCard(cardId) {
        state.cards = state.cards.filter(function(c) { return c.id !== cardId; });
        saveCards();
        renderCards();
        renderTimeline();
        renderCalendar();
        updateSchedulePreview();
        showToast('Card deleted', 'success');
    }

    function updateStats() {
        document.getElementById('totalCards').textContent = state.cards.length;

        let dueSoon = 0, billingSoon = 0, paid = 0;
        for (let i = 0; i < state.cards.length; i++) {
            const card = state.cards[i];
            if (isCardPaidThisCycle(card)) { paid++; }
            else if (getDaysUntil(card.dueDate) <= 3) { dueSoon++; }
            if (getDaysUntil(card.billingDate) <= 3) { billingSoon++; }
        }

        document.getElementById('dueSoon').textContent = dueSoon;
        document.getElementById('billingSoon').textContent = billingSoon;
        document.getElementById('paidCount').textContent = paid;
    }

    function renderTimeline() {
        const timeline = document.getElementById('timeline');

        if (state.cards.length === 0) {
            timeline.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><h3>No Upcoming Dates</h3><p>Add credit cards to see their due dates here</p></div>';
            return;
        }

        const events = [];
        for (let i = 0; i < state.cards.length; i++) {
            const card = state.cards[i];
            events.push({ type: 'billing', card: card, daysUntil: getDaysUntil(card.billingDate), date: card.billingDate, isPaid: false });
            events.push({ type: 'due', card: card, daysUntil: getDaysUntil(card.dueDate), date: card.dueDate, isPaid: isCardPaidThisCycle(card) });
        }

        events.sort(function(a, b) { return a.daysUntil - b.daysUntil; });

        const upcoming = events.filter(function(e) { return e.daysUntil >= 0 && e.daysUntil <= 14; });

        if (upcoming.length === 0) {
            timeline.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><h3>All Clear!</h3><p>No due dates in the next 14 days</p></div>';
            return;
        }

        let html = '';
        for (let i = 0; i < upcoming.length; i++) {
            const e = upcoming[i];
            let statusClass = e.isPaid ? 'paid' : (e.daysUntil <= 3 ? 'urgent' : (e.daysUntil <= 7 ? 'warning' : ''));
            const icon = e.type === 'due' ? 'üí≥' : 'üìã';
            const typeText = e.type === 'due' ? 'Payment Due' : 'Billing Date';
            const dayText = e.daysUntil === 0 ? 'Today' : (e.daysUntil === 1 ? 'Tomorrow' : 'In ' + e.daysUntil + ' days');

            html += '<div class="timeline-item ' + statusClass + '"><div class="timeline-card">';
            html += '<div class="timeline-date">' + dayText + ' ‚Ä¢ ' + getOrdinal(e.date) + '</div>';
            html += '<div class="timeline-title">' + icon + ' ' + (e.card.cardName || e.card.bankName) + ' - ' + typeText;
            if (e.isPaid) html += '<span class="paid-badge">PAID</span>';
            html += '</div><div class="timeline-subtitle">' + e.card.bankName + ' ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ' + e.card.last4Digits + '</div></div></div>';
        }

        timeline.innerHTML = html;
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const monthLabel = document.getElementById('calendarMonth');

        const year = state.calendarDate.getFullYear();
        const month = state.calendarDate.getMonth();
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        monthLabel.textContent = monthNames[month] + ' ' + year;

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDay = firstDay.getDay();
        const totalDays = lastDay.getDate();
        const today = new Date();
        const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;

        const dueDates = [], billingDates = [];
        for (let i = 0; i < state.cards.length; i++) {
            dueDates.push(state.cards[i].dueDate);
            billingDates.push(state.cards[i].billingDate);
        }

        let html = '';
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        for (let i = 0; i < dayNames.length; i++) html += '<div class="calendar-day-header">' + dayNames[i] + '</div>';

        const prevMonth = new Date(year, month, 0);
        for (let i = startingDay - 1; i >= 0; i--) html += '<div class="calendar-day other-month">' + (prevMonth.getDate() - i) + '</div>';

        for (let day = 1; day <= totalDays; day++) {
            const isToday = isCurrentMonth && day === today.getDate();
            const hasDue = dueDates.indexOf(day) !== -1;
            const hasBilling = billingDates.indexOf(day) !== -1 && !hasDue;
            let classes = 'calendar-day';
            if (isToday) classes += ' today';
            if (hasDue) classes += ' has-due';
            if (hasBilling) classes += ' has-billing';
            html += '<div class="' + classes + '">' + day + '</div>';
        }

        const remaining = 42 - (startingDay + totalDays);
        for (let day = 1; day <= remaining; day++) html += '<div class="calendar-day other-month">' + day + '</div>';

        grid.innerHTML = html;
    }

    function renderColorPicker() {
        const picker = document.getElementById('colorPicker');
        let html = '';
        for (let i = 0; i < CARD_COLORS.length; i++) {
            const c = CARD_COLORS[i];
            html += '<div class="color-option ' + (c.id === state.selectedColor ? 'selected' : '') + '" style="background:' + c.gradient + ';" data-color="' + c.id + '"></div>';
        }
        picker.innerHTML = html;

        const options = picker.querySelectorAll('.color-option');
        for (let i = 0; i < options.length; i++) {
            options[i].addEventListener('click', function() {
                selectColor(this.dataset.color);
            });
        }
    }

    function selectColor(colorId) {
        state.selectedColor = colorId;
        const options = document.querySelectorAll('.color-option');
        for (let i = 0; i < options.length; i++) {
            options[i].classList.toggle('selected', options[i].dataset.color === colorId);
        }
    }

    function updateNotificationBanner() {
        const banner = document.getElementById('notificationBanner');
        if (!('Notification' in window) || Notification.permission === 'granted') {
            banner.classList.add('hidden');
        } else {
            banner.classList.remove('hidden');
        }
    }

    function updateFabVisibility() {
        const fab = document.getElementById('fabAddBtn');
        if (state.currentView === 'dashboard') {
            fab.classList.remove('hidden');
        } else {
            fab.classList.add('hidden');
        }
    }

    // ========================================
    // MODAL FUNCTIONS
    // ========================================

    function openAddCardModal() {
        state.editingCardId = null;
        state.selectedColor = CARD_COLORS[0].id;
        state.selectedBank = null;
        state.selectedReminder = 3;

        document.getElementById('modalTitle').textContent = 'Add New Card';
        document.getElementById('cardForm').reset();
        document.getElementById('cardId').value = '';
        document.getElementById('bankSearch').value = '';
        document.getElementById('notifyOnBilling').checked = false;
        document.getElementById('notifyBeforeDue').checked = true;
        document.getElementById('otherBankInput').classList.remove('show');

        renderColorPicker();
        renderBankSelector();
        updateReminderSelection();
        document.getElementById('cardModal').classList.add('active');
    }

    function openEditCardModal(cardId) {
        let card = null;
        for (let i = 0; i < state.cards.length; i++) {
            if (state.cards[i].id === cardId) { card = state.cards[i]; break; }
        }
        if (!card) {
            showToast('Card not found', 'error');
            return;
        }

        state.editingCardId = cardId;
        state.selectedColor = card.color || CARD_COLORS[0].id;
        state.selectedBank = card.bankId || null;
        state.selectedReminder = (card.reminderDays && card.reminderDays[0]) || 3;

        document.getElementById('modalTitle').textContent = 'Edit Card';
        document.getElementById('cardId').value = card.id;
        document.getElementById('cardHolderName').value = card.cardHolderName || '';
        document.getElementById('cardName').value = card.cardName || '';
        document.getElementById('cardNetwork').value = card.network || 'visa';
        document.getElementById('last4Digits').value = card.last4Digits || '';
        document.getElementById('creditLimit').value = card.creditLimit || '';
        document.getElementById('billingDate').value = card.billingDate || 1;
        document.getElementById('dueDate').value = card.dueDate || 1;
        document.getElementById('bankSearch').value = '';
        document.getElementById('notifyOnBilling').checked = card.notifyOnBilling || false;
        document.getElementById('notifyBeforeDue').checked = card.notifyBeforeDue !== false;

        if (card.bankId === 'other') {
            document.getElementById('customBankName').value = card.bankName || '';
            document.getElementById('otherBankInput').classList.add('show');
        } else {
            document.getElementById('customBankName').value = '';
            document.getElementById('otherBankInput').classList.remove('show');
        }

        renderColorPicker();
        renderBankSelector();
        updateReminderSelection();
        document.getElementById('cardModal').classList.add('active');
    }

    function closeCardModal() {
        document.getElementById('cardModal').classList.remove('active');
        state.editingCardId = null;
    }

    function selectReminder(days) {
        state.selectedReminder = days;
        updateReminderSelection();
    }

    function updateReminderSelection() {
        const chips = document.querySelectorAll('.reminder-chip');
        for (let i = 0; i < chips.length; i++) {
            chips[i].classList.toggle('selected', parseInt(chips[i].dataset.days) === state.selectedReminder);
        }
    }

    // ========================================
    // CARD CRUD OPERATIONS
    // ========================================

    function saveCard(event) {
        event.preventDefault();

        if (!state.selectedBank) {
            showToast('Please select a bank', 'warning');
            return;
        }

        let bankName = '';
        if (state.selectedBank === 'other') {
            bankName = document.getElementById('customBankName').value.trim();
            if (!bankName) { showToast('Please enter bank name', 'warning'); return; }
        } else {
            for (let i = 0; i < POPULAR_BANKS.length; i++) {
                if (POPULAR_BANKS[i].id === state.selectedBank) { bankName = POPULAR_BANKS[i].name; break; }
            }
        }

        const existingCard = state.editingCardId ? state.cards.find(function(c) { return c.id === state.editingCardId; }) : null;

        const cardData = {
            id: document.getElementById('cardId').value || generateId(),
            cardHolderName: document.getElementById('cardHolderName').value.trim(),
            cardName: document.getElementById('cardName').value.trim(),
            bankId: state.selectedBank,
            bankName: bankName,
            network: document.getElementById('cardNetwork').value,
            last4Digits: document.getElementById('last4Digits').value,
            creditLimit: parseInt(document.getElementById('creditLimit').value) || 0,
            billingDate: parseInt(document.getElementById('billingDate').value),
            dueDate: parseInt(document.getElementById('dueDate').value),
            color: state.selectedColor,
            notifyOnBilling: document.getElementById('notifyOnBilling').checked,
            notifyBeforeDue: document.getElementById('notifyBeforeDue').checked,
            reminderDays: [state.selectedReminder],
            paidCycles: existingCard ? (existingCard.paidCycles || []) : [],
            createdAt: existingCard ? existingCard.createdAt : new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };

        if (state.editingCardId) {
            for (let i = 0; i < state.cards.length; i++) {
                if (state.cards[i].id === state.editingCardId) { state.cards[i] = cardData; break; }
            }
            showToast('Card updated successfully!', 'success');
        } else {
            state.cards.push(cardData);
            showToast('Card added successfully!', 'success');
        }

        saveCards();
        closeCardModal();
        renderCards();
        renderTimeline();
        renderCalendar();
        updateSchedulePreview();
    }

    // ========================================
    // DATA IMPORT/EXPORT
    // ========================================

    function exportData() {
        const data = { version: APP_CONFIG.version, exportDate: new Date().toISOString(), cards: state.cards, settings: state.settings };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'cardguard-backup-' + new Date().toISOString().split('T')[0] + '.json';
        a.click();
        URL.revokeObjectURL(url);
        showToast('Data exported successfully!', 'success');
    }

    function importData() {
        document.getElementById('fileInput').click();
    }

    function handleFileImport(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.cards && Array.isArray(data.cards)) {
                    showConfirmModal(
                        'Import Cards?',
                        'Replace all existing cards with ' + data.cards.length + ' imported cards?',
                        'warning',
                        'btn-primary',
                        function() {
                            state.cards = data.cards;
                            if (data.settings) {
                                state.settings = { ...state.settings, ...data.settings, notificationTimes: { ...state.settings.notificationTimes, ...(data.settings.notificationTimes || {}) } };
                                saveSettings();
                            }
                            saveCards();
                            renderCards();
                            renderTimeline();
                            renderCalendar();
                            applyTheme();
                            updateSettingsUI();
                            updateSchedulePreview();
                            hideConfirmModal();
                            showToast('Imported ' + data.cards.length + ' cards!', 'success');
                        }
                    );
                } else {
                    throw new Error('Invalid format');
                }
            } catch (error) {
                showToast('Error importing file', 'error');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    function clearAllData() {
        showConfirmModal(
            '‚ö†Ô∏è Delete All Data?',
            'This will permanently delete ALL cards and settings. Export a backup first!',
            'danger',
            'btn-danger',
            function() {
                hideConfirmModal();

                setTimeout(function() {
                    showConfirmModal(
                        'üö® Final Confirmation',
                        'Last chance! This action cannot be undone. Continue?',
                        'danger',
                        'btn-danger',
                        function() {
                            state.cards = [];
                            state.settings = { pushNotifications: false, soundAlerts: true, defaultReminderDays: 3, darkMode: false, notificationTimes: { morning: true, afternoon: false, evening: false }, customTimeEnabled: false, customTime: '10:00', maxNotificationsPerDay: 2, urgentAlerts: true, consolidatedSummary: true };

                            localStorage.removeItem(APP_CONFIG.storageKey);
                            localStorage.removeItem(APP_CONFIG.settingsKey);
                            localStorage.removeItem('cardguard_lastnotifdate');
                            localStorage.removeItem('cardguard_notifcount');
                            localStorage.removeItem('cardguard_slotsdate');
                            localStorage.removeItem('cardguard_usedslots');

                            usedTimeSlots = {};
                            saveCards();
                            saveSettings();
                            applyTheme();
                            renderCards();
                            renderTimeline();
                            renderCalendar();
                            updateSettingsUI();
                            updateSchedulePreview();
                            hideConfirmModal();
                            showToast('All data cleared', 'success');
                        }
                    );
                }, 300);
            }
        );
    }

    // ========================================
    // THEME MANAGEMENT
    // ========================================

    function toggleTheme() {
        state.settings.darkMode = !state.settings.darkMode;
        saveSettings();
        applyTheme();
        document.getElementById('darkModeToggle').checked = state.settings.darkMode;
    }

    function applyTheme() {
        if (state.settings.darkMode) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        } else {
            document.documentElement.removeAttribute('data-theme');
            document.getElementById('themeToggle').textContent = 'üåô';
        }
    }

    // ========================================
    // VIEW NAVIGATION
    // ========================================

    function switchView(viewName) {
        state.currentView = viewName;

        const tabs = document.querySelectorAll('.nav-tab');
        for (let i = 0; i < tabs.length; i++) tabs[i].classList.toggle('active', tabs[i].dataset.view === viewName);

        const views = document.querySelectorAll('.view');
        for (let i = 0; i < views.length; i++) views[i].classList.toggle('active', views[i].id === viewName + 'View');

        updateFabVisibility();

        if (viewName === 'timeline') renderTimeline();
        else if (viewName === 'calendar') renderCalendar();
        else if (viewName === 'settings') updateSchedulePreview();
    }

    // ========================================
    // TOAST NOTIFICATIONS
    // ========================================

    function showToast(message, type) {
        type = type || 'info';
        const container = document.getElementById('toastContainer');
        const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };

        const toast = document.createElement('div');
        toast.className = 'toast ' + type;
        toast.innerHTML = '<span class="toast-icon">' + icons[type] + '</span><span class="toast-message">' + message + '</span>';

        container.appendChild(toast);
        setTimeout(function() { toast.classList.add('show'); }, 10);
        setTimeout(function() { toast.classList.remove('show'); setTimeout(function() { toast.remove(); }, 300); }, 4000);
    }

    // ========================================
    // SETTINGS UI
    // ========================================

    function updateSettingsUI() {
        document.getElementById('pushNotificationsToggle').checked = state.settings.pushNotifications;
        document.getElementById('soundAlertsToggle').checked = state.settings.soundAlerts;
        document.getElementById('defaultReminderDays').value = state.settings.defaultReminderDays;
        document.getElementById('darkModeToggle').checked = state.settings.darkMode;

        const t9 = document.getElementById('notifyTime9AM'); if (t9) t9.checked = state.settings.notificationTimes.morning;
        const t2 = document.getElementById('notifyTime2PM'); if (t2) t2.checked = state.settings.notificationTimes.afternoon;
        const t6 = document.getElementById('notifyTime6PM'); if (t6) t6.checked = state.settings.notificationTimes.evening;

        document.getElementById('enableCustomTime').checked = state.settings.customTimeEnabled;
        const customInput = document.getElementById('customNotificationTime');
        if (customInput && state.settings.customTime) {
            customInput.value = state.settings.customTime;
        }

        const wrapper = document.getElementById('customTimeWrapper');
        if (state.settings.customTimeEnabled) wrapper.classList.add('show');
        else wrapper.classList.remove('show');

        const freqBtns = document.querySelectorAll('.freq-btn');
        for (let i = 0; i < freqBtns.length; i++) freqBtns[i].classList.toggle('active', parseInt(freqBtns[i].dataset.freq) === state.settings.maxNotificationsPerDay);

        document.getElementById('urgentAlertsToggle').checked = state.settings.urgentAlerts;
        document.getElementById('consolidatedSummaryToggle').checked = state.settings.consolidatedSummary;

        updateSchedulePreview();
    }

    // ========================================
    // PWA INSTALLATION
    // ========================================

    function handleInstallPrompt(e) {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installPwaBtn').style.display = 'block';
    }

    function installPWA() {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function(result) {
            if (result.outcome === 'accepted') showToast('App installed!', 'success');
            deferredPrompt = null;
            document.getElementById('installPwaBtn').style.display = 'none';
        });
    }

    // ========================================
    // EVENT LISTENERS
    // ========================================

    function initEventListeners() {
        // Navigation
        const tabs = document.querySelectorAll('.nav-tab');
        for (let i = 0; i < tabs.length; i++) {
            tabs[i].addEventListener('click', function() { switchView(this.dataset.view); });
        }

        // Theme
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // Add card buttons
        document.getElementById('headerAddBtn').addEventListener('click', openAddCardModal);
        document.getElementById('fabAddBtn').addEventListener('click', openAddCardModal);

        // Notification banner
        document.getElementById('enableNotificationsBtn').addEventListener('click', requestNotificationPermission);

        // Card form
        document.getElementById('cardForm').addEventListener('submit', saveCard);

        // Bank search
        document.getElementById('bankSearch').addEventListener('input', function(e) {
            filterBanks(e.target.value);
        });

        // Card Modal
        document.getElementById('closeModal').addEventListener('click', closeCardModal);
        document.getElementById('cancelBtn').addEventListener('click', closeCardModal);
        document.getElementById('cardModal').addEventListener('click', function(e) { if (e.target.id === 'cardModal') closeCardModal(); });

        // Card Actions Modal
        document.getElementById('closeCardActionsModal').addEventListener('click', closeCardActionsModal);
        document.getElementById('cardActionsModal').addEventListener('click', function(e) { if (e.target.id === 'cardActionsModal') closeCardActionsModal(); });
        document.getElementById('actionMarkPaid').addEventListener('click', handleMarkPaidAction);
        document.getElementById('actionEdit').addEventListener('click', handleEditAction);
        document.getElementById('actionDelete').addEventListener('click', handleDeleteAction);

        // Confirm modal
        document.getElementById('confirmCancelBtn').addEventListener('click', hideConfirmModal);
        document.getElementById('confirmOkBtn').addEventListener('click', function() {
            if (confirmCallback) confirmCallback();
        });
        document.getElementById('confirmModal').addEventListener('click', function(e) { if (e.target.id === 'confirmModal') hideConfirmModal(); });

        // Reminder chips
        const chips = document.querySelectorAll('.reminder-chip');
        for (let i = 0; i < chips.length; i++) {
            chips[i].addEventListener('click', function() { selectReminder(parseInt(this.dataset.days)); });
        }

        // Calendar
        document.getElementById('prevMonth').addEventListener('click', function() { state.calendarDate.setMonth(state.calendarDate.getMonth() - 1); renderCalendar(); });
        document.getElementById('nextMonth').addEventListener('click', function() { state.calendarDate.setMonth(state.calendarDate.getMonth() + 1); renderCalendar(); });
        document.getElementById('todayBtn').addEventListener('click', function() { state.calendarDate = new Date(); renderCalendar(); });

        // Push toggle
        document.getElementById('pushNotificationsToggle').addEventListener('change', function(e) {
            if (e.target.checked) {
                requestNotificationPermission().then(function(granted) {
                    e.target.checked = granted;
                    if (granted) startNotificationScheduler();
                });
            } else {
                state.settings.pushNotifications = false;
                saveSettings();
                showToast('Notifications disabled', 'info');
            }
        });

        // Sound toggle
        document.getElementById('soundAlertsToggle').addEventListener('change', function(e) {
            state.settings.soundAlerts = e.target.checked;
            saveSettings();
        });

        // Default reminder
        document.getElementById('defaultReminderDays').addEventListener('change', function(e) {
            state.settings.defaultReminderDays = parseInt(e.target.value);
            saveSettings();
            updateSchedulePreview();
        });

        // Dark mode
        document.getElementById('darkModeToggle').addEventListener('change', toggleTheme);

        // Time checkboxes
        const t9 = document.getElementById('notifyTime9AM');
        if (t9) t9.addEventListener('change', function(e) { state.settings.notificationTimes.morning = e.target.checked; saveSettings(); updateSchedulePreview(); });

        const t2 = document.getElementById('notifyTime2PM');
        if (t2) t2.addEventListener('change', function(e) { state.settings.notificationTimes.afternoon = e.target.checked; saveSettings(); updateSchedulePreview(); });

        const t6 = document.getElementById('notifyTime6PM');
        if (t6) t6.addEventListener('change', function(e) { state.settings.notificationTimes.evening = e.target.checked; saveSettings(); updateSchedulePreview(); });

        // Custom time toggle
        document.getElementById('enableCustomTime').addEventListener('change', function(e) {
            state.settings.customTimeEnabled = e.target.checked;
            const wrapper = document.getElementById('customTimeWrapper');
            if (e.target.checked) wrapper.classList.add('show');
            else wrapper.classList.remove('show');
            saveSettings();
            updateSchedulePreview();
        });

        // Custom time input
        const customTimeInput = document.getElementById('customNotificationTime');
        if (customTimeInput) {
            customTimeInput.addEventListener('change', function(e) {
                state.settings.customTime = e.target.value;
                saveSettings();
                updateSchedulePreview();
                showToast('Custom time: ' + formatTime12Hour(state.settings.customTime), 'success');
            });
        }

        // Frequency buttons
        const freqBtns = document.querySelectorAll('.freq-btn');
        for (let i = 0; i < freqBtns.length; i++) {
            freqBtns[i].addEventListener('click', function() {
                const freq = parseInt(this.dataset.freq);
                state.settings.maxNotificationsPerDay = freq;
                const allBtns = document.querySelectorAll('.freq-btn');
                for (let j = 0; j < allBtns.length; j++) allBtns[j].classList.toggle('active', parseInt(allBtns[j].dataset.freq) === freq);
                saveSettings();
                showToast('Max ' + freq + ' notification(s)/day', 'info');
            });
        }

        // Urgent alerts
        document.getElementById('urgentAlertsToggle').addEventListener('change', function(e) {
            state.settings.urgentAlerts = e.target.checked;
            saveSettings();
        });

        // Consolidated summary
        document.getElementById('consolidatedSummaryToggle').addEventListener('change', function(e) {
            state.settings.consolidatedSummary = e.target.checked;
            saveSettings();
            updateSchedulePreview();
        });

        // Data buttons
        document.getElementById('exportDataBtn').addEventListener('click', exportData);
        document.getElementById('exportBeforeDeleteBtn').addEventListener('click', exportData);
        document.getElementById('importDataBtn').addEventListener('click', importData);
        document.getElementById('clearDataBtn').addEventListener('click', clearAllData);

        // File input
        document.getElementById('fileInput').addEventListener('change', handleFileImport);

        // PWA
        document.getElementById('installPwaBtn').addEventListener('click', installPWA);
        window.addEventListener('beforeinstallprompt', handleInstallPrompt);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCardModal();
                closeCardActionsModal();
                hideConfirmModal();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openAddCardModal();
            }
        });

        // Visibility change - refresh when tab becomes visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                if (state.lastNotificationDate !== getTodayDateString()) {
                    state.notificationsSentToday = 0;
                    state.lastNotificationDate = getTodayDateString();
                    usedTimeSlots = {};
                    saveNotificationCount();
                    saveUsedTimeSlots();
                }
                renderCards();
                updateSchedulePreview();
                if (state.settings.pushNotifications && Notification.permission === 'granted') {
                    runScheduledCheck();
                }
            }
        });

        // Before unload - save everything
        window.addEventListener('beforeunload', function() {
            saveSettings();
            saveCards();
            saveNotificationCount();
            saveUsedTimeSlots();
        });
    }

    // ========================================
    // INITIALIZATION
    // ========================================

    function init() {
        console.log('üöÄ CardGuard v' + APP_CONFIG.version + ' starting...');

        populateDateSelects();
        loadCards();
        loadSettings();
        applyTheme();
        renderCards();
        renderTimeline();
        renderCalendar();
        renderColorPicker();
        renderBankSelector();
        updateSettingsUI();
        updateNotificationBanner();
        updateSchedulePreview();
        updateFabVisibility();
        initEventListeners();

        if (state.settings.pushNotifications && Notification.permission === 'granted') {
            startNotificationScheduler();
        }

        console.log('‚úÖ CardGuard ready!', { cards: state.cards.length, permission: Notification.permission });
    }

    // ========================================
    // START APPLICATION
    // ========================================

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

</script>

</body>
</html>